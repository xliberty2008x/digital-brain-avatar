#!/usr/bin/env python3
"""
–ü—Ä–æ—Å—Ç–∏–π —Ç–µ—Å—Ç –¥–ª—è jwt_handler.py
–ó–∞–ø—É—Å–∫–∞–π: python test_jwt.py
"""

from digital_brain.security.jwt_handler import create_access_token, decode_access_token
from datetime import timedelta
import time

print("=" * 60)
print("üß™ –¢–ï–°–¢–£–í–ê–ù–ù–Ø JWT HANDLER")
print("=" * 60)

# –¢–µ—Å—Ç 1: –°—Ç–≤–æ—Ä–µ–Ω–Ω—è —Ç–æ–∫–µ–Ω–∞
print("\n1Ô∏è‚É£  –°—Ç–≤–æ—Ä—é—î–º–æ —Ç–æ–∫–µ–Ω –¥–ª—è —é–∑–µ—Ä–∞ 'cyril'...")
test_data = {
    "sub": "cyril@gmail.com",
    "role": "admin",
    "user_id": 123
}

token = create_access_token(test_data)
print(f"‚úÖ –¢–æ–∫–µ–Ω —Å—Ç–≤–æ—Ä–µ–Ω–æ!")
print(f"üìù –¢–æ–∫–µ–Ω (–ø–µ—Ä—à—ñ 50 —Å–∏–º–≤–æ–ª—ñ–≤): {token[:50]}...")
print(f"üìè –î–æ–≤–∂–∏–Ω–∞ —Ç–æ–∫–µ–Ω–∞: {len(token)} —Å–∏–º–≤–æ–ª—ñ–≤")

# –¢–µ—Å—Ç 2: –î–µ–∫–æ–¥—É–≤–∞–Ω–Ω—è —Ç–æ–∫–µ–Ω–∞
print("\n2Ô∏è‚É£  –î–µ–∫–æ–¥—É—î–º–æ —Ç–æ–∫–µ–Ω...")
decoded = decode_access_token(token)
if decoded:
    print("‚úÖ –¢–æ–∫–µ–Ω —É—Å–ø—ñ—à–Ω–æ –¥–µ–∫–æ–¥–æ–≤–∞–Ω–æ!")
    print(f"üì¶ –î–∞–Ω—ñ –∑ —Ç–æ–∫–µ–Ω–∞:")
    for key, value in decoded.items():
        if key != "exp":  # exp - —Ü–µ timestamp, –≤–∏–≥–ª—è–¥–∞—î —Å—Ç—Ä–∞—à–Ω–æ
            print(f"   - {key}: {value}")
else:
    print("‚ùå –ü–æ–º–∏–ª–∫–∞ –¥–µ–∫–æ–¥—É–≤–∞–Ω–Ω—è!")

# –¢–µ—Å—Ç 3: –¢–æ–∫–µ–Ω –∑ –∫–æ—Ä–æ—Ç–∫–∏–º —Ç–µ—Ä–º—ñ–Ω–æ–º –¥—ñ—ó (2 —Å–µ–∫—É–Ω–¥–∏)
print("\n3Ô∏è‚É£  –°—Ç–≤–æ—Ä—é—î–º–æ —Ç–æ–∫–µ–Ω, —è–∫–∏–π –∂–∏–≤–µ 2 —Å–µ–∫—É–Ω–¥–∏...")
short_token = create_access_token(
    {"sub": "test_user"}, 
    expires_delta=timedelta(seconds=2)
)
print("‚úÖ –¢–æ–∫–µ–Ω —Å—Ç–≤–æ—Ä–µ–Ω–æ!")

print("‚è≥ –ß–µ–∫–∞—î–º–æ 3 —Å–µ–∫—É–Ω–¥–∏...")
time.sleep(3)

print("üîç –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ –ø—Ä–æ—Å—Ç—Ä–æ—á–µ–Ω–∏–π —Ç–æ–∫–µ–Ω...")
expired_decoded = decode_access_token(short_token)
if expired_decoded is None:
    print("‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ! –¢–æ–∫–µ–Ω –ø—Ä–æ—Å—Ç—Ä–æ—á–µ–Ω–∏–π —ñ –Ω–µ –ø—Ä–æ–π—à–æ–≤ –ø–µ—Ä–µ–≤—ñ—Ä–∫—É")
else:
    print("‚ùå –ü–æ–º–∏–ª–∫–∞: –ø—Ä–æ—Å—Ç—Ä–æ—á–µ–Ω–∏–π —Ç–æ–∫–µ–Ω –Ω–µ –º–∞—î –ø—Ä–∞—Ü—é–≤–∞—Ç–∏!")

# –¢–µ—Å—Ç 4: –ü—ñ–¥—Ä–æ–±–ª–µ–Ω–∏–π —Ç–æ–∫–µ–Ω
print("\n4Ô∏è‚É£  –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ –ø—ñ–¥—Ä–æ–±–ª–µ–Ω–∏–π —Ç–æ–∫–µ–Ω...")
fake_token = token[:-10] + "HACKED1234"  # –ó–º—ñ–Ω—é—î–º–æ –∫—ñ–Ω–µ—Ü—å —Ç–æ–∫–µ–Ω–∞
print("üîç –ù–∞–º–∞–≥–∞—î–º–æ—Å—å –¥–µ–∫–æ–¥—É–≤–∞—Ç–∏ –ø—ñ–¥—Ä–æ–±–ª–µ–Ω–∏–π —Ç–æ–∫–µ–Ω...")
hacked_decoded = decode_access_token(fake_token)
if hacked_decoded is None:
    print("‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ! –ü—ñ–¥—Ä–æ–±–ª–µ–Ω–∏–π —Ç–æ–∫–µ–Ω –Ω–µ –ø—Ä–æ–π—à–æ–≤ –ø–µ—Ä–µ–≤—ñ—Ä–∫—É")
else:
    print("‚ùå –ù–ï–ë–ï–ó–ü–ï–ö–ê! –ü—ñ–¥—Ä–æ–±–ª–µ–Ω–∏–π —Ç–æ–∫–µ–Ω –ø—Ä–æ–π—à–æ–≤ –ø–µ—Ä–µ–≤—ñ—Ä–∫—É!")

print("\n" + "=" * 60)
print("üéâ –¢–ï–°–¢–£–í–ê–ù–ù–Ø –ó–ê–í–ï–†–®–ï–ù–û!")
print("=" * 60)
